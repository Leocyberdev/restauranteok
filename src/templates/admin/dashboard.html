{% extends "admin/base.html" %}

{% block title %}Dashboard - RestaurantePro{% endblock %}
{% block header %}Dashboard{% endblock %}

{% block content %}
<!-- Hero Section com Métricas Principais -->
<div class="hero-metrics mb-5">
    <div class="row g-4">
        <div class="col-xl-3 col-lg-6 col-md-6">
            <div class="metric-card metric-primary">
                <div class="metric-content">
                    <div class="metric-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="metric-info">
                        <h3 class="metric-value" data-is-currency="false">{{ orders_today }}</h3>
                        <p class="metric-label">Pedidos Hoje</p>
                        <div class="metric-trend">
                            <i class="fas fa-arrow-up"></i>
                            <span>+12% vs ontem</span>
                        </div>
                    </div>
                </div>
                <div class="metric-bg-pattern"></div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6 col-md-6">
            <div class="metric-card metric-success">
                <div class="metric-content">
                    <div class="metric-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="metric-info">
                        <h3 class="metric-value" data-is-currency="true">R$ {{ "%.2f"|format(sales_today) }}</h3>
                        <p class="metric-label">Vendas Hoje</p>
                        <div class="metric-trend">
                            <i class="fas fa-arrow-up"></i>
                            <span>+8% vs ontem</span>
                        </div>
                    </div>
                </div>
                <div class="metric-bg-pattern"></div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6 col-md-6">
            <div class="metric-card metric-warning">
                <div class="metric-content">
                    <div class="metric-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="metric-info">
                        <h3 class="metric-value" data-is-currency="false">{{ pending_orders }}</h3>
                        <p class="metric-label">Pedidos Pendentes</p>
                        <div class="metric-trend">
                            <i class="fas fa-hourglass-half"></i>
                            <span>Aguardando preparo</span>
                        </div>
                    </div>
                </div>
                <div class="metric-bg-pattern"></div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6 col-md-6">
            <div class="metric-card metric-info">
                <div class="metric-content">
                    <div class="metric-icon">
                        <i class="fas fa-calendar-week"></i>
                    </div>
                    <div class="metric-info">
                        <h3 class="metric-value" data-is-currency="false">{{ orders_week }}</h3>
                        <p class="metric-label">Pedidos da Semana</p>
                        <div class="metric-trend">
                            <i class="fas fa-calendar"></i>
                            <span>Últimos 7 dias</span>
                        </div>
                    </div>
                </div>
                <div class="metric-bg-pattern"></div>
            </div>
        </div>
    </div>
</div>

<!-- Dashboard Grid Layout -->
<div class="dashboard-grid">
    <!-- Seção Financeira -->
    <div class="financial-section">
        <div class="section-header">
            <h2><i class="fas fa-chart-line me-2"></i>Resumo Financeiro</h2>
            <div class="period-selector">
                <input type="radio" class="btn-check" name="periodFilter" id="dailyFilter" value="daily">
                <label class="btn btn-outline-primary btn-sm" for="dailyFilter">Diário</label>
                
                <input type="radio" class="btn-check" name="periodFilter" id="weeklyFilter" value="weekly">
                <label class="btn btn-outline-primary btn-sm" for="weeklyFilter">Semana</label>
                
                <input type="radio" class="btn-check" name="periodFilter" id="monthlyFilter" value="monthly" checked>
                <label class="btn btn-outline-primary btn-sm" for="monthlyFilter">Mês</label>
            </div>
        </div>

        <div class="financial-cards">
            <div class="financial-card revenue">
                <div class="card-icon">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="card-content">
                    <h4>R$ {{ "%.2f"|format(sales_month) }}</h4>
                    <p>Vendas do Mês</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 75%"></div>
                    </div>
                    <small>Meta: R$ {{ "%.2f"|format(sales_month * 1.2) }}</small>
                </div>
            </div>

            <div class="financial-card expenses">
                <div class="card-icon">
                    <i class="fas fa-receipt"></i>
                </div>
                <div class="card-content">
                    <h4>R$ {{ "%.2f"|format(monthly_expenses) }}</h4>
                    <p>Despesas Mensais</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 45%"></div>
                    </div>
                    <small>Últimos 30 dias</small>
                </div>
            </div>

            <div class="financial-card cost">
                <div class="card-icon">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="card-content">
                    <h4>R$ {{ "%.2f"|format(estimated_product_cost) }}</h4>
                    <p>Custo dos Produtos</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 60%"></div>
                    </div>
                    <small>Custo no mês</small>
                </div>
            </div>

            <div class="financial-card profit {% if final_balance >= 0 %}positive{% else %}negative{% endif %}">
                <div class="card-icon">
                    <i class="fas fa-{% if final_balance >= 0 %}chart-line{% else %}chart-line-down{% endif %}"></i>
                </div>
                <div class="card-content">
                    <h4>R$ {{ "%.2f"|format(final_balance) }}</h4>
                    <p>Saldo Final</p>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {% if final_balance >= 0 %}85{% else %}25{% endif %}%"></div>
                    </div>
                    <small>{% if final_balance >= 0 %}Lucro{% else %}Prejuízo{% endif %} mensal</small>
                </div>
            </div>
        </div>

        <!-- Gráfico Financeiro -->
        <div class="chart-container">
            <canvas id="financialChart"></canvas>
        </div>
    </div>

    <!-- Seção de Produtos -->
    <div class="products-section">
        <div class="section-header">
            <h2><i class="fas fa-trophy me-2"></i>Produtos Mais Vendidos</h2>
            <span class="badge bg-gradient-primary">Top 5</span>
        </div>

        {% if top_products %}
            <div class="products-list">
                {% for product in top_products[:5] %}
                <div class="product-item">
                    <div class="product-rank">
                        <span class="rank-number">{{ loop.index }}</span>
                    </div>
                    <div class="product-icon">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <div class="product-info">
                        <h5>{{ product.name }}</h5>
                        <p>{{ product.total_sold }} unidades vendidas</p>
                    </div>
                    <div class="product-trend">
                        <span class="trend-badge positive">
                            <i class="fas fa-arrow-up"></i>
                            +{{ (loop.index * 5) }}%
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <h4>Nenhum produto vendido ainda</h4>
                <p>Comece adicionando produtos ao seu cardápio</p>
                <a href="{{ url_for('admin.products') }}" class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>Adicionar Produtos
                </a>
            </div>
        {% endif %}
    </div>

    <!-- Ações Rápidas -->
    <div class="quick-actions">
        <div class="section-header">
            <h2><i class="fas fa-bolt me-2"></i>Ações Rápidas</h2>
        </div>

        <div class="actions-grid">
            <a href="{{ url_for('admin.orders') }}" class="action-card orders">
                <div class="action-icon">
                    <i class="fas fa-shopping-bag"></i>
                </div>
                <div class="action-content">
                    <h4>Ver Pedidos</h4>
                    <p>Gerenciar pedidos ativos</p>
                </div>
                <div class="action-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </a>

            <a href="{{ url_for('admin.products') }}" class="action-card products">
                <div class="action-icon">
                    <i class="fas fa-plus-circle"></i>
                </div>
                <div class="action-content">
                    <h4>Novo Produto</h4>
                    <p>Adicionar ao cardápio</p>
                </div>
                <div class="action-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </a>

            <a href="{{ url_for('admin.expenses') }}" class="action-card expenses">
                <div class="action-icon">
                    <i class="fas fa-receipt"></i>
                </div>
                <div class="action-content">
                    <h4>Registrar Despesa</h4>
                    <p>Controle financeiro</p>
                </div>
                <div class="action-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </a>

            <a href="{{ url_for('admin.promotions') }}" class="action-card promotions">
                <div class="action-icon">
                    <i class="fas fa-percent"></i>
                </div>
                <div class="action-content">
                    <h4>Nova Promoção</h4>
                    <p>Criar ofertas especiais</p>
                </div>
                <div class="action-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </a>
        </div>
    </div>
</div>

<style>
/* Estilos específicos do novo dashboard */
.hero-metrics {
    margin-bottom: 3rem;
}

.metric-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 24px;
    padding: 2rem;
    position: relative;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    height: 100%;
}

.metric-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
}

.metric-card.metric-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.metric-card.metric-success {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
}

.metric-card.metric-warning {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    color: white;
}

.metric-card.metric-info {
    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    color: #2d3748;
}

.metric-content {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    position: relative;
    z-index: 2;
}

.metric-icon {
    width: 80px;
    height: 80px;
    border-radius: 20px;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    backdrop-filter: blur(10px);
}

.metric-info h3 {
    font-size: 2.5rem;
    font-weight: 700;
    margin: 0;
    line-height: 1;
}

.metric-label {
    font-size: 1rem;
    font-weight: 600;
    margin: 0.5rem 0;
    opacity: 0.9;
}

.metric-trend {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    font-weight: 500;
    opacity: 0.8;
}

.metric-bg-pattern {
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
    z-index: 1;
}

.dashboard-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    grid-template-rows: auto auto;
    gap: 2rem;
    grid-template-areas: 
        "financial products"
        "actions actions";
}

.financial-section {
    grid-area: financial;
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 24px;
    padding: 2rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.products-section {
    grid-area: products;
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 24px;
    padding: 2rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.quick-actions {
    grid-area: actions;
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 24px;
    padding: 2rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.section-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #e2e8f0;
}

.section-header h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2d3748;
    margin: 0;
}

.period-selector {
    display: flex;
    gap: 0.5rem;
}

.financial-cards {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.financial-card {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border-radius: 16px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.financial-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
}

.financial-card.revenue {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
}

.financial-card.expenses {
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    color: white;
}

.financial-card.cost {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    color: white;
}

.financial-card.profit.positive {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.financial-card.profit.negative {
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    color: white;
}

.financial-card .card-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    backdrop-filter: blur(10px);
}

.financial-card .card-content h4 {
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0;
}

.financial-card .card-content p {
    font-size: 0.875rem;
    font-weight: 600;
    margin: 0.25rem 0;
    opacity: 0.9;
}

.progress-bar {
    width: 100%;
    height: 4px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 2px;
    margin: 0.5rem 0;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 2px;
    transition: width 0.3s ease;
}

.financial-card small {
    font-size: 0.75rem;
    opacity: 0.8;
}

.chart-container {
    background: #ffffff;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
}

.products-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.product-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
}

.product-item:hover {
    transform: translateX(8px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
}

.product-rank {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
}

.product-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #667eea;
    font-size: 1.25rem;
}

.product-info {
    flex: 1;
}

.product-info h5 {
    font-size: 1rem;
    font-weight: 600;
    margin: 0;
    color: #2d3748;
}

.product-info p {
    font-size: 0.875rem;
    color: #718096;
    margin: 0.25rem 0 0 0;
}

.trend-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.trend-badge.positive {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
}

.empty-state {
    text-align: center;
    padding: 3rem 1rem;
}

.empty-icon {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1.5rem;
    font-size: 2rem;
    color: #718096;
}

.empty-state h4 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 0.5rem;
}

.empty-state p {
    color: #718096;
    margin-bottom: 1.5rem;
}

.actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.action-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    background: #ffffff;
    border-radius: 16px;
    text-decoration: none;
    color: inherit;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.action-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
    text-decoration: none;
    color: inherit;
}

.action-card.orders {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.action-card.products {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
}

.action-card.expenses {
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    color: white;
}

.action-card.promotions {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    color: white;
}

.action-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    backdrop-filter: blur(10px);
}

.action-content {
    flex: 1;
}

.action-content h4 {
    font-size: 1.125rem;
    font-weight: 600;
    margin: 0;
}

.action-content p {
    font-size: 0.875rem;
    margin: 0.25rem 0 0 0;
    opacity: 0.9;
}

.action-arrow {
    font-size: 1.25rem;
    opacity: 0.7;
    transition: all 0.3s ease;
}

.action-card:hover .action-arrow {
    transform: translateX(4px);
    opacity: 1;
}

/* Responsividade */
@media (max-width: 1200px) {
    .dashboard-grid {
        grid-template-columns: 1fr;
        grid-template-areas: 
            "financial"
            "products"
            "actions";
    }
}

@media (max-width: 768px) {
    .metric-content {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
    }

    .metric-icon {
        width: 60px;
        height: 60px;
        font-size: 1.5rem;
    }

    .metric-info h3 {
        font-size: 2rem;
    }

    .financial-cards {
        grid-template-columns: 1fr;
    }

    .section-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }

    .actions-grid {
        grid-template-columns: 1fr;
    }

    .action-card {
        padding: 1rem;
    }

    .action-icon {
        width: 50px;
        height: 50px;
        font-size: 1.25rem;
    }
}

@media (max-width: 480px) {
    .hero-metrics .row {
        gap: 1rem;
    }

    .metric-card {
        padding: 1.5rem;
    }

    .financial-section,
    .products-section,
    .quick-actions {
        padding: 1.5rem;
    }

    .product-item {
        padding: 0.75rem;
    }

    .product-rank {
        width: 35px;
        height: 35px;
        font-size: 0.875rem;
    }

    .product-icon {
        width: 40px;
        height: 40px;
        font-size: 1rem;
    }
}

/* Animações */
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.metric-card {
    animation: slideInUp 0.6s ease-out;
}

.financial-section {
    animation: slideInLeft 0.8s ease-out;
}

.products-section {
    animation: slideInRight 0.8s ease-out;
}

.quick-actions {
    animation: slideInUp 1s ease-out;
}

/* Adicionar delays para animações escalonadas */
.metric-card:nth-child(1) { animation-delay: 0.1s; }
.metric-card:nth-child(2) { animation-delay: 0.2s; }
.metric-card:nth-child(3) { animation-delay: 0.3s; }
.metric-card:nth-child(4) { animation-delay: 0.4s; }

.product-item:nth-child(1) { animation: slideInRight 0.6s ease-out 0.5s both; }
.product-item:nth-child(2) { animation: slideInRight 0.6s ease-out 0.6s both; }
.product-item:nth-child(3) { animation: slideInRight 0.6s ease-out 0.7s both; }
.product-item:nth-child(4) { animation: slideInRight 0.6s ease-out 0.8s both; }
.product-item:nth-child(5) { animation: slideInRight 0.6s ease-out 0.9s both; }

.action-card:nth-child(1) { animation: slideInUp 0.6s ease-out 0.6s both; }
.action-card:nth-child(2) { animation: slideInUp 0.6s ease-out 0.7s both; }
.action-card:nth-child(3) { animation: slideInUp 0.6s ease-out 0.8s both; }
.action-card:nth-child(4) { animation: slideInUp 0.6s ease-out 0.9s both; }
</style>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Dados financeiros por período
    const financialData = {
        daily: {
            sales: {{ sales_today }},
            expenses: {{ monthly_expenses / 30 }}, // Estimativa diária
            productCost: {{ estimated_product_cost / 30 }} // Estimativa diária
        },
        weekly: {
            sales: {{ sales_today * 7 }}, // Estimativa semanal
            expenses: {{ monthly_expenses / 4 }}, // Estimativa semanal
            productCost: {{ estimated_product_cost / 4 }} // Estimativa semanal
        },
        monthly: {
            sales: {{ sales_month }},
            expenses: {{ monthly_expenses }},
            productCost: {{ estimated_product_cost }}
        }
    };

    // Gráfico financeiro
    const ctx = document.getElementById('financialChart').getContext('2d');
    let currentChart;
    
    function createFinancialChart(period = 'monthly') {
        const data = financialData[period];
        const profitValue = data.sales - data.expenses - data.productCost;
        
        if (currentChart) {
            currentChart.destroy();
        }
        
        currentChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Receitas', 'Despesas', 'Custo Produtos'],
                datasets: [{
                    data: [data.sales, data.expenses, data.productCost],
                    backgroundColor: [
                        'rgba(79, 172, 254, 0.8)',
                        'rgba(250, 112, 154, 0.8)',
                        'rgba(67, 233, 123, 0.8)'
                    ],
                    borderColor: [
                        '#4facfe',
                        '#fa709a',
                        '#43e97b'
                    ],
                    borderWidth: 3,
                    cutout: '60%'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            font: {
                                size: 12,
                                weight: '600'
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed.toLocaleString('pt-BR', {
                                    style: 'currency',
                                    currency: 'BRL'
                                });
                            }
                        }
                    }
                }
            }
        });
    }
    
    // Event listeners para os filtros
    document.addEventListener('DOMContentLoaded', function() {
        // Criar gráfico inicial
        createFinancialChart('monthly');
        
        // Adicionar event listeners aos filtros
        const filterRadios = document.querySelectorAll('input[name="periodFilter"]');
        filterRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.checked) {
                    createFinancialChart(this.value);
                }
            });
        });
    });

    // Animação apenas para contadores numéricos (não monetários)
    function animateCounter(element, target) {
        const start = 0;
        const duration = 2000;
        const increment = target / (duration / 16);
        let current = start;
        
        const timer = setInterval(() => {
            current += increment;
            if (current >= target) {
                current = target;
                clearInterval(timer);
            }
            element.textContent = Math.floor(current).toLocaleString('pt-BR');
        }, 16);
    }

    // Inicializar animações apenas para contagens (não monetários)
    document.addEventListener('DOMContentLoaded', function() {
        const counters = document.querySelectorAll('.metric-value[data-is-currency="false"]');
        counters.forEach(counter => {
            const target = parseInt(counter.textContent.replace(/[^0-9]/g, ''));
            if (!isNaN(target)) {
                counter.textContent = '0';
                setTimeout(() => animateCounter(counter, target), 1000);
            }
        });

        // Animação das barras de progresso
        setTimeout(() => {
            const progressBars = document.querySelectorAll('.progress-fill');
            progressBars.forEach(bar => {
                const width = bar.style.width;
                bar.style.width = '0%';
                setTimeout(() => {
                    bar.style.width = width;
                }, 100);
            });
        }, 1500);
    });

    // Efeito de hover nos cards de métricas
    document.querySelectorAll('.metric-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-8px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });

    // Efeito de parallax suave no background
    window.addEventListener('scroll', function() {
        const scrolled = window.pageYOffset;
        const parallax = document.querySelector('.hero-metrics');
        if (parallax) {
            const speed = scrolled * 0.5;
            parallax.style.transform = `translateY(${speed}px)`;
        }
    });
</script>
{% endblock %}

